<h1>Sélectionnez vos produits</h1>

<% @products.each do |product| %>
  <div class="product_line">
    <div>
      <% if product.photo.present? %>
        <%= cl_image_tag product.photo, class: "avatar_bordered" %>
      <% else %>
        <div class="avatar_bordered"></div>
      <% end %>
    </div>

    <div class="product_info">
      <span class="product-title"> <%= product.name.capitalize %></span>
      <span class="product-price"><%= product.price %> € / <%= product.unit %></span><br>
      <span class="text-small"><%= product.description %></span>
    </div>

    <div class="product_quantity">
      <% if @order.contains?(product) %>
        <% product_order = @order.product_orders.find_by(product_id: product.id) %>

        <%= simple_form_for(product_order) do |f| %>
          <%= f.number_field :quantity %>
          <div class="product-unit text-small"><%= product.unit %>(s)</div>
          <%= button_tag(class: "btn btn-outline-primary btn-product-list") do %>
            <i class="fas fa-check-circle"></i>
          <% end %>
          <%= link_to product_order_path(product_order), method: :delete do %>
            <i class="fas fa-trash-alt"></i>
          <% end %>
        <% end %>
      <% else %>
        <%= render 'product_orders/form', order: @order, product: product %>
      <% end %>
    </div>
  </div>

  <% if current_user.admin? %>
    <%= link_to "Editer", edit_product_path(product) %>
    <%= link_to "Supprimer", product_path(product), method: :delete, data: { confirm: "Attention, vous allez perdre toutes les commandes associées ! Voulez-vous vraiment supprimer cet utilisateur ?" } %>
    <% if product.active? %>
      <%= link_to "Desactiver", change_active_product_path(product) %>
    <% else %>
      <span class="activate_product"> <%= link_to "Activer", change_active_product_path(product) %></span>
    <% end %>
  <% end %>
<% end %>
